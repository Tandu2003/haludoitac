!function(){function e(){if(("checkout_contact_view"===C||"checkout_all_view"===C||"checkout_payment_view"===C)&&(o.value=Bizweb.Checkout.fbEvent?Bizweb.Checkout.fbEvent.value:"",o.content_ids=Bizweb.Checkout.fbEvent?Bizweb.Checkout.fbEvent.content_ids:[],o.metadata.num_items=Bizweb.Checkout.fbEvent?Bizweb.Checkout.fbEvent.num_items:0,o.contents=Bizweb.Checkout.fbEvent?Bizweb.Checkout.fbEvent.contents:[]),"product_view"===C||"product_view_from_search"===C){o.value=BizwebAnalytics.meta.product.price,o.content_ids=[BizwebAnalytics.meta.product.id],o.metadata.content_name=BizwebAnalytics.meta.product.name;var e=BizwebAnalytics.meta.product;o.contents=[Object.assign({},e,{item_price:e.price},{price:null})]}u.postData(y,o,w,x)}function t(){e(),o.action="view",u.postData(b,o,null,x)}function a(e,t,a,n){this.xhr=e,this.url=t,this.method=a,this.body=n}var n,i,o,c,r,s,u={getCookie:function e(t){for(var a,n=t+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(a=i[o];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(n))return a.substring(n.length,a.length)}},setCookie:function e(t,a,n){var i,o=new Date;o.setTime(o.getTime()+6e4*n),i="expires="+o.toUTCString(),document.cookie=t+"="+a+";"+i+";path=/"},getUUID:function e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},postData:function e(t,a,i,o){(a=Object.assign({},a),BizwebAnalytics.meta.customer&&(a.customer_id=BizwebAnalytics.meta.customer.id),n)?(a.fp=n,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(e){return e.json()}).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})):new Promise(function(e,t){var a=document.createElement("script");a.onload=e,a.onerror=t,a.async=!0,a.src="./fp.v3.3.0.min.js",document.head.appendChild(a)}).then(function(){return FingerprintJS.load()}).then(function(e){return e.get()}).then(function(e){return e.visitorId}).then(function(e){n=e,a.fp=n,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(e){return e.json()}).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})})},getParamValue:function e(t,a){return new URLSearchParams(a.toLowerCase()).get(t.toLowerCase())}};u.getCookie("_landing_full_page")||u.getCookie("_landing_type")||!Bizweb.template||(u.setCookie("_landing_full_page",location.href,21600),u.setCookie("_landing_type",Bizweb.template,21600));var d=window.BizwebAnalytics.tracking_url,h=u.getCookie("_s"),m=u.getCookie("_v"),l=!!sessionStorage.getItem("active"),p=u.getCookie("_landing_full_page"),f=u.getCookie("_landing_type"),v=unescape(u.getCookie("_landing_page")),g=!1;m&&((i=u.getCookie("_v_new"))||(g=!0));var k=u.getCookie("_origin_reference_site"),y=d+"/api/v1/page-views",b=d+"/api/v1/product-actions",w=function(){u.setCookie("_s",h,30),u.setCookie("_v",m,1576800),u.setCookie("_origin_reference_site",k,43200),g||u.setCookie("_v_new",!0,30)},x=function(e){console.error(e)};h||(h=u.getUUID()),m||(m=u.getUUID()),void 0===k&&(k=document.referrer);var C,$,D=Bizweb?Bizweb.id:0,E=document.referrer,I=k,S=h,_=m,T=location.href,P=!1,j=!1;switch(Bizweb.template){case"collection":C="/collections/all"!==location.pathname?"collection_view":"page_view";break;case"product":P=!0,$=location.pathname,C="product_view",""!==document.referrer&&"/search"===new URL(document.referrer).pathname&&(C="product_view_from_search");break;case"cart":C="cart_view";break;case"checkout":if(Bizweb.Checkout)switch(j=!0,u.getParamValue("step",location.search)){case"contact_information":C="checkout_contact_view";break;case"shipping_method":C="checkout_shipping_view";break;case"payment_method":C="checkout_payment_view";break;default:C="checkout_all_view"}break;case"thankyou":Bizweb.checkout&&(C="thank_you_view");break;default:C="page_view"}switch(sessionStorage.setItem("active","active"),o={session_type:C,active_session:l,store_id:D,session_id:S,visitor_id:_,reference_site:E,origin_reference_site:I,current_site:T,landing_type:f,landing_page:v,landing_full_page:p,visit_returning:g,product_alias:$,first_time_access:Bizweb.first_time_accessed,currency:BizwebAnalytics.meta.currency,from_product_view:P,article_id:BizwebAnalytics.meta.article?BizwebAnalytics.meta.article.id:void 0,fb_event_id:Bizweb.fbEventId,metadata:{fbp:u.getCookie("_fbp"),fbc:u.getCookie("_fbc"),ttclid:u.getCookie("ttclid"),ttp:u.getCookie("_ttp"),external_id:BizwebAnalytics.meta&&BizwebAnalytics.meta.customer?BizwebAnalytics.meta.customer.id:null,customer_first_name:BizwebAnalytics.meta&&BizwebAnalytics.meta.customer?BizwebAnalytics.meta.customer.first_name:null,customer_last_name:BizwebAnalytics.meta&&BizwebAnalytics.meta.customer?BizwebAnalytics.meta.customer.last_name:null,customer_phone:BizwebAnalytics.meta&&BizwebAnalytics.meta.customer?BizwebAnalytics.meta.customer.phone:null},email:BizwebAnalytics.meta&&BizwebAnalytics.meta.customer?BizwebAnalytics.meta.customer.email:null},j&&(o.fb_event_id=Bizweb.fbEventIdInitiateCheckout),C){case"page_view":case"cart_view":case"checkout_contact_view":case"checkout_shipping_view":case"checkout_payment_view":case"checkout_all_view":case"collection_view":e();break;case"product_view":t();break;case"product_view_from_search":t(),o.action="search",u.postData(b,o,null,x);break;case"thank_you_view":Bizweb.first_time_accessed&&(o.value=Bizweb.checkout.line_items_subtotal_price,o.content_ids=Bizweb.checkout.line_items.map(function(e){return e.variant_id}),o.email=Bizweb.checkout.email,o.city=Bizweb.checkout.billing_address.city,o.country=Bizweb.checkout.billing_address.country_code,o.contents=Bizweb.checkout.line_items.map(function(e){return{id:e.variant_id,quantity:e.quantity,item_price:e.price_final,name:e.title}}),u.postData(y,o,w,x),o.action="purchase",Bizweb.checkout.line_items.forEach(function(e){o.product_id=e.product_id,o.variant_id=e.variant_id,u.postData(b,o,null,x)}),o.metadata.order_id=Bizweb.checkout.order_id.toString(),Bizweb.checkout.customer_id&&(o.metadata.external_id=Bizweb.checkout.customer_id.toString()),Bizweb.checkout.customer_first_name&&(o.metadata.customer_first_name=Bizweb.checkout.customer_first_name),Bizweb.checkout.customer_first_name&&(o.metadata.customer_last_name=Bizweb.checkout.customer_last_name),Bizweb.checkout.customer_phone&&(o.metadata.customer_phone=Bizweb.checkout.customer_phone),o.num_items=Bizweb.checkout.line_items.reduce(function(e,t){return e+t.quantity},0))}a.prototype.onReadyStateChange=function(){this.xhr.readyState===XMLHttpRequest.DONE&&this.handleXhrDone({method:this.method,url:this.url,body:this.body,xhr:this.xhr}),this.oldOnReadyStateChange&&this.oldOnReadyStateChange(this.xhr)},a.prototype.handleXhrDone=function(e){var t,a;try{switch(e.url){case"/cart/add.js":e.xhr.responseText&&(t=JSON.parse(e.xhr.responseText),o.session_type="add_to_cart",o.active_session=!0,o.value=t.price*t.quantity,o.content_ids=[t.variant_id],o.contents=[{id:t.variant_id,quantity:t.quantity,item_price:t.price,name:t.name},],a=e.xhr.getResponseHeader("Date"),o.fb_event_id=Bizweb.fbEventId+(a?new Date(a).getTime():null),u.postData(y,o,w,x),o.variant_id=u.getParamValue("variantId",e.body),o.action="add_to_cart",u.postData(b,o,w,x),"/search"===new URL(location.href).pathname&&(o.action="search",u.postData(b,o,w,x)));break;case"/cart/change.js":"0"===u.getParamValue("quantity",e.body)&&(o.variant_id=u.getParamValue("variantId",e.body),o.action="remove_from_cart",u.postData(b,o,w,x))}}catch(n){console.error(n.message)}return e},c=XMLHttpRequest.prototype.open,r=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.open=function(e,t){return this._url=t,this._method=e,c.apply(this,arguments)},XMLHttpRequest.prototype.send=function(e){var t=new a(this,this._url,this._method,e);return this.addEventListener?this.addEventListener("readystatechange",t.onReadyStateChange.bind(t),!1):(t.oldOnReadyStateChange=this.onreadystatechange,this.onreadystatechange=t.onReadyStateChange),r.call(this,e)},"function"==typeof(s=window.fetch)&&(window.fetch=function(){return s.apply(window,Array.prototype.slice.call(arguments)).then(function(e){var t;if(!e.ok)return e;try{switch(e.url){case"/cart/add.js":t=response.headers.get("Date"),o.fb_event_id=Bizweb.fbEventId+(t?new Date(t).getTime():null),o.session_type="add_to_cart",o.active_session=!0,u.postData(y,o,w,x),o.variant_id=u.getParamValue("variantId",e.body),o.action="add_to_cart",u.postData(b,o,w,x),"/search"===new URL(location.href).pathname&&(o.action="search",u.postData(b,o,w,x));break;case"/cart/change.js":t=response.headers.get("Date"),"0"===u.getParamValue("quantity",query)&&(o.variant_id=u.getParamValue("variantId",e.body),o.action="remove_from_cart",u.postData(b,o,w,x))}}catch(a){console.error(a.message)}return e})})}();
